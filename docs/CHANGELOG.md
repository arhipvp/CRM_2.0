# CRM 2.0 — изменения

## [Unreleased]

### Инфраструктура
- Сценарий инициализации PostgreSQL включает расширение `pgcrypto` вместе с `uuid-ossp`, чтобы гарантировать доступность криптографических функций в локальной среде.
- Улучшен `infra/postgres/init.sh`: роли сервисов пересоздаются с правами `LOGIN` и `CREATEDB`, им выдаётся `GRANT CREATE` на базу и схемы, а схема `tasks` и перекрёстные доступы `crm` к `documents`/`auth` подготавливаются автоматически.

### Очистка клиентских артефактов
- Исключён архив с макетами и UX-описаниями Next.js-интерфейса: клиентский UI больше не поставляется вместе с backend-репозиторием.
- README и сопутствующие инструкции описывают только backend-сценарии (`bootstrap`, `dev-up`, ручной запуск сервисов, Telegram-бот).
- Навигационные документы (`docs/tech-stack.md`, `docs/local-setup.md`, `docs/ai-development-plan.md`) обновлены так, чтобы указывать на актуальные каналы работы (Gateway, Telegram-бот) и не ссылаться на удалённый UI.

### Схема данных
- В таблицу `crm.policies` добавлено поле `premium` (`numeric(12,2)`), фиксирующее страховую премию по оформленному полису.
- Миграция `2025102601_add_tasks_module` корректно работает с уже существующей схемой `tasks`: при отсутствии прав владельца операция не падает, а выводит диагностическое сообщение, позволяя продолжить bootstrap.

### Backend
- Удалён легаси-сервис `backend/tasks`: модуль задач поддерживается только внутри CRM (`backend/crm`). Обновлены README, документация и `env.example`, чтобы отразить новое расположение и переменные окружения (`CRM_TASKS_EVENTS_SOURCE`).
- Из тестовой конфигурации CRM удалена устаревшая переменная окружения `CRM_DEFAULT_TENANT_ID`; тесты больше не полагаются на tenant-настройки.
- Миграция `2025102604_migrate_crm_tasks_to_tasks_schema` больше не копирует `tenantId` в payload и не требует `tenant_id` при откате.
