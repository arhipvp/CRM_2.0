# Экран «Воронка сделок»

- **Описание макета:** визуализация стадий сделки с дашбордом конверсий; скриншоты и схемы расположены в `docs/frontend/mockups/deal-funnel/`.
- **Текстовая спецификация состояний:** [spec.md](mockups/deal-funnel/spec.md).
- **Назначение:** управление стадиями сделки, быстрый переход к карточке клиента, контроль метрик конверсии.

## Основные блоки
1. **Хедер:** фильтры по периодам и менеджерам, быстрый поиск по сделкам, счётчики стадий и переключатель режимов (канбан/таблица).
2. **Колонки стадий (канбан):** карточки сделок с ключевыми атрибутами (клиент, сумма, вероятность, дедлайн) и поддержкой drag-and-drop.
3. **Табличный режим:** компактный список сделок с теми же данными и массовым выбором.
4. **Боковая панель превью:** быстрое описание сделки, команды и ссылок на детальную карточку.

## Пользовательские действия
- Перетаскивание карточек между стадиями с обновлением статуса и подсказкой об успехе/ошибке.
- Открытие быстрого превью и переход к детальной карточке клиента/полиса в обоих режимах отображения.
- Массовый выбор карточек (канбан и таблица) для последующих действий.
- Переключение между канбаном и таблицей из верхнего хедера.

## Состояния элементов
- **Загрузка:** скелетон карточек и индикатор в хедере.
- **Успех:** всплывающее подтверждение с авто-скрытием 3 с.
- **Ошибка обновления стадии:** баннер в зоне доски с кнопкой «Повторить» и toast-уведомлением.
- **Ошибка синхронизации:** отображается баннер с предупреждением и кнопка «Обновить данные»; drag-and-drop временно недоступен.
- **Превью закрыто:** сайдбар скрывается, пока пользователь не выберет карточку.
- **Валидация фильтров:** обязательные поля подсвечиваются красной рамкой и подсказкой.

## Критерии приёмки
- Перетаскивание должно обновлять стадию не позднее 500 мс после drop.
- Фильтры применяются без перезагрузки страницы, отображая индикатор активности.
- Карточки с просроченным дедлайном подсвечиваются цветом согласно гайдлайну и попадают в раздел «Риски».
- Массовые операции доступны только при выборе ≥1 карточки, состояние кнопок соответствует выбору.

## Требования к доступности
- Перетаскивание дублируется клавиатурными действиями (стрелки + Enter) и контекстным меню.
- Для каждой карточки определён `aria-label` с ключевой информацией (клиент, сумма, стадия).
- Контраст текста и фона соответствует WCAG AA.
- Toast-уведомления фокусируются и озвучиваются screen reader'ом, предоставляя кнопку закрытия.
- Табличный режим поддерживает навигацию клавиатурой и выбор чекбоксами.
