# Карточка расчёта и форма ввода

Документ описывает UI-блок «Расчёты» в правом сайдбаре сделки. Карточка
используется исполнителями и продавцами для фиксации предложений страховых
компаний, отслеживания статуса согласования и хранения связанных файлов.

## Структура карточки расчёта
- **Заголовок:** название страховой компании и программа (краткое наименование).
- **Метаданные:** дата создания расчёта, ответственный исполнитель, пометка о
  статусе («Черновик», «Ожидает подтверждения», «Готово», «Архив»).
- **Финансовые параметры:** страховая премия (в валюте сделки) и срок действия
  предложения (`validFrom` → `validTo`). Значения выводятся парами с иконкой
  состояния: зелёная при актуальном сроке, янтарная за 7 дней до истечения,
  красная при истёкшем сроке.
- **Ссылки на файлы:** до трёх ссылок на загруженные документы (PDF/XLSX) с
  иконкой типа, подписью автора загрузки и датой последнего обновления.
- **Действия:** контекстное меню с пунктами «Редактировать», «Подтвердить»,
  «Отметить как архивный», «Скопировать ссылку», «Удалить» (недоступно для
  подтверждённых расчётов).

## Форма создания и редактирования расчёта
Форма открывается в боковой панели или модальном окне и состоит из трёх
логических блоков. Inline-валидация подсвечивает ошибочные поля, сообщения
выводятся под инпутами.

| Поле | Тип | Обязательность | Правила и подсказки |
| --- | --- | --- | --- |
| Страховая компания | выпадающий список | да | Значения подтягиваются из справочника страховых; поиск по вводу. |
| Программа страхования | текстовый инпут | да | До 120 символов, подсказка с шаблоном (например, «Каско, пакет Премиум»). |
| Страховая премия | числовой инпут | да | Только положительные значения, формат `#,###.##`. При ошибке отображается сообщение «Укажите сумму премии». |
| Срок действия | диапазон дат | да | Поля `validFrom`, `validTo`; `validTo` не может быть раньше `validFrom`, диапазон не может превышать 365 дней. |
| Ссылки на файлы | список ссылок | нет | Каждая ссылка содержит название файла и URL, автоматически проверяется на корректность формата `https://`. |
| Комментарий исполнителя | многострочный инпут | нет | До 500 символов. Используется для фиксации нюансов расчёта. |

Дополнительно при редактировании отображается блок истории версий с датой и
именем автора изменений. После сохранения карточка обновляется без
перезагрузки страницы.

## Состояния подтверждения и архивации
- **Черновик:** базовое состояние после создания. Доступны все поля редактирования
  и действие «Подтвердить». Карточка подсвечивается серой рамкой.
- **Ожидает подтверждения:** устанавливается после отправки расчёта на проверку.
  Меню действий содержит «Отменить отправку», «Подтвердить» (для уполномоченных
  ролей) и «Архивировать». В блоке отображается бейдж с именем инициатора.
- **Подтверждён:** доступно только для ролей с правом финального согласования.
  Карточка фиксируется, разрешены действия «Создать полис» и «Архивировать».
  Финансовые данные становятся read-only, рядом отображается подпись с датой и
  именем подтвердившего сотрудника.
- **Архив:** расчёт перемещается в нижнюю часть списка с полупрозрачным
  отображением. Доступно действие «Вернуть в работу», которое возвращает статус
  «Черновик» и требует указать причину восстановления. Расчёты в архиве скрыты по
  умолчанию и показываются по переключателю «Показать архив». 
