# Пользовательские сценарии по ролям

Документ описывает ключевые сценарии использования CRM 2.0 для утверждённых ролей доступа. Каждый сценарий включает бизнес-цель, последовательность действий, критерии приёмки и требования к доступности. Подробное описание ролевой модели см. в разделе «Пользовательские роли» основного README.

## Главный админ
- **Цель:** управлять пользователями, системными справочниками и аудитом.
- **Последовательность:**
  1. Создать нового пользователя, назначить одну из доступных ролей и зафиксировать изменение.
  2. Обновить справочники (типы сделок, статусы задач) и проверить, что формы CRM используют новые значения.
  3. Просмотреть аудит последних операций, отфильтровать события по пользователю и выгрузить отчёт.
- **Критерии приёмки:**
  - Новый пользователь появляется в списке без перезагрузки, роль применяется мгновенно.
  - Изменения справочников моментально отображаются в формах создания сделки и задачи.
  - Журнал аудита поддерживает фильтры по типу события и экспорт в CSV/JSON.
- **Доступность:**
  - Формы управления пользователями и справочниками доступны с клавиатуры и имеют явные `label`.
  - Таблицы пользователей и аудита поддерживают навигацию через клавиатуру и озвучивание заголовков.

## Продавец (агент)
- **Цель:** провести сделку от создания лида до выпуска полиса.
- **Последовательность:**
  1. Создать нового клиента или открыть существующего из воронки.
  2. Завести сделку, заполнить ключевые параметры и добавить заметку в журнал.
  3. Назначить исполнителя на подготовку расчётов и создать задачу с дедлайном.
  4. В карточке сделки использовать быстрые правки (стадия, сумма, вероятность) и вкладки «Задачи/Документы/Финансы» для контроля прогресса.
  5. После подтверждения клиентом выбранного предложения инициировать выпуск полиса и загрузить сканы документов.
- **Критерии приёмки:**
  - Сделка обновляется без перезагрузки, отображается в нужной колонке воронки.
  - Карточки в воронке сортируются по `nextReviewAt`: просроченные обзоры закреплены сверху, остальные идут по возрастанию даты, поле всегда заполнено.
  - Быстрые правки подсвечиваются и синхронизируются с журналом активности.
  - Созданная задача появляется в списке исполнителя и в календаре.
  - Загруженные документы отображаются в карточке сделки, сохраняется история версий.
  - Статус сделки и полиса синхронизирован с журналом и уведомлениями.
- **Доступность:**
  - Канбан-вью и карточки сделок управляются клавиатурой, состояние колонок озвучивается.
  - Файловые элементы имеют текстовые описания и доступны для screen reader.

## Исполнитель
- **Цель:** подготовить расчёты и оформить полис по назначенной сделке.
- **Последовательность:**
  1. Получить уведомление о новой задаче, открыть карточку сделки и ознакомиться с требованиями.
  2. Переключиться на вкладку «Документы», загрузить расчётные файлы и добавить заметку в журнал.
  3. После выбора клиентом варианта обновить детали полиса и статус подготовки в блоке быстрого редактирования.
  4. Закрыть задачу, указав фактическое время и приложив итоговые файлы.
- **Критерии приёмки:**
  - Уведомление помечается как прочитанное и перемещается в историю.
  - Комментарии и заметки отображаются с именем автора и временной меткой.
  - Статус полиса меняется на «черновик/готов к выпуску» и синхронизируется с Payments для последующих действий.
  - Закрытая задача исчезает из активного списка и попадает в архив с возможностью фильтрации.
- **Доступность:**
  - Комментарии и формы редактирования полиса доступны для ввода с клавиатуры.
  - Таблицы расчётов имеют читабельные заголовки и альтернативный текст для числовых значений.


## Будущие дополнения

* Отслеживание SLA для службы поддержки появится в [дорожной карте Tasks (Этап 1.1)](../delivery-plan.md#2-приоритизация-последующих-этапов) и будет описано после реализации автоматических напоминаний.
