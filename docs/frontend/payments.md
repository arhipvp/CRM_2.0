# Экран «Платежи»

- **Описание макета:** таблица и карточки платежей со сводкой статусов; визуальные состояния размещены в `docs/frontend/mockups/deal-funnel/` до появления отдельного экрана.
- **Назначение:** контроль графика платежей, подтверждение поступлений и выплат, отслеживание отмен и переносов.

## Отображение статусов платежей

| Код | Метка в интерфейсе | Назначение состояния | UI-представление |
| --- | --- | --- | --- |
| `planned` | Запланирован | Платёж внесён в график, счёт ещё не выставлен. | Серый бейдж, индикатор «план» в колонке даты. |
| `expected` | Ожидается | Счёт отправлен, ожидается подтверждение поступления или списания. | Жёлтый бейдж, подсказка о требуемом контроле. |
| `received` | Получен | Поступление средств на счёт подтверждено. | Зелёный бейдж, отметка фактической даты. |
| `paid_out` | Выплачен | Сумма перечислена контрагенту или распределена как комиссия/скидка. | Синий бейдж, иконка исходящего перевода. |
| `cancelled` | Отменён | Платёж отменён либо перенесён без движения денег. | Красный бейдж, обязательный тултип с причиной. |

> Тексты и назначения статусов синхронизируются со [справочником Payments](../data-model.md#справочник-статусов-платежей); изменение словарей выполняется централизованно.

## Пользовательские действия
- Подтверждение платежа со сменой статуса и фактической даты.
- Перевод статуса в «Отменён» с обязательным комментарием.
- Фильтрация и группировка списка по текущим статусам.

## Обновления в реальном времени
- Экран подписывается на SSE-канал Gateway `/api/v1/streams/payments` (переменная `NEXT_PUBLIC_PAYMENTS_SSE_URL`) для синхронизации статусов без ручного обновления.
- События `payment.status.changed` и `payment.overdue` приводят к точечному обновлению строк таблицы и уведомлений о просрочке.
- При ошибке подключения отображается баннер с предложением перезагрузить страницу и ссылка на справку по устранению неполадок.

## Требования к доступности
- Бейджи статусов имеют текст и `aria-label` с расшифровкой состояния.
- Цветовые индикаторы сопровождаются иконкой/текстом для пользователей с дальтонизмом.
- Фильтры по статусам доступны клавиатурой и озвучиваются screen reader'ом.
