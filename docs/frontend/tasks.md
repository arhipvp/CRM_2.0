# Экран «Задачи и планирование»

- **Описание макета:** комбинированная доска задач с табличным и канбан-представлением; актуальные материалы лежат в `docs/frontend/mockups/tasks-board/`.
- **Текстовая спецификация состояний:** [spec.md](mockups/tasks-board/spec.md).
- **Назначение:** управление индивидуальными и командными задачами, визуализация приоритетов и дедлайнов.

## Основные блоки
1. **Список задач:** табличное и канбан-представление с переключателем вида.
2. **Фильтры и поиск:** по статусу, исполнителю, типу активности, тегам.
3. **Календарь напоминаний:** недельный и месячный обзор внутри приложения.
4. **Панель массовых действий:** изменение статуса, назначение исполнителя, перенос сроков.
5. **Модальное окно создания задачи:** вызывается из шапки экрана кнопкой «Создать задачу» и позволяет выбрать шаблон или собрать кастомный сценарий.

### Роли пользователей
- **Продавец (агент):** создаёт и отслеживает задачи, назначает исполнителей, настраивает приоритеты и сроки.
- **Исполнитель:** получает назначенные задачи, обновляет статус выполнения и сообщает о выполнении или переносе сроков.

## Пользовательские действия
- Создание задачи с шаблоном (тип, приоритет, связанная сделка/клиент).
- Редактирование статуса, сроков и ответственных.
- Массовое закрытие задач и перенос дедлайнов.

### Шаблоны задач
- **Оформить выбранный полис:** устанавливает тип «Документы», срок на следующий рабочий день и напоминание накануне, связывает задачу с текущей сделкой/клиентом и добавляет теги «оформление», «полис».
- **Связаться с клиентом:** формирует задачу-фоллоу-ап на ближайшие часы после отправки расчёта, отмечает статус «Ожидает клиента» и добавляет соответствующий тег.
- **Подготовить продление:** создаёт напоминание за две недели до продления с тегом «продление» и автоматическим напоминанием за пару дней до дедлайна.
- **Пользовательский сценарий:** открывает пустую форму без пресетов, но с подсказками по обязательным полям.

Модальное окно поддерживает обязательные поля **Название**, **Срок**, **Исполнитель**, валидацию дат (запрет на прошлые значения и проверку напоминаний относительно дедлайна), а также автоподстановку сделки и клиента по выбранному контексту (например, первой выделенной задаче или фильтрам).

## Состояния элементов
- **Загрузка:** спиннеры в таблице и placeholder карточки в канбане.
- **Валидация:** обязательные поля формы создания (название, срок, исполнитель) подсвечиваются при пустом значении; даты проверяются на прошлое время.
- **Ошибки синхронизации:** отображаются в верхней панели с кнопкой повторной синхронизации.
- **Конфликт изменений:** модальное окно с выбором версии (локально/сервер).

## Критерии приёмки
- Переключение вида (таблица/канбан) сохраняется в пользовательских настройках.
- Массовые действия недоступны без выбранных задач и отображают счётчик выбранных элементов.
- После изменения статуса задачи список и показатели сделок обновляются автоматически без ручного обновления страницы.
- После создания или изменения задач глобальный список «Задачи и планирование» обновляется автоматически; при успешном создании показывается уведомление об имени новой задачи.
- Список и канбан обновляют данные без перезагрузки страницы, спиннеры скрываются после успешной синхронизации.
- Календарь отображает задачи по срокам внутри приложения без внешней синхронизации.

## Реализация
- Компонент `TaskList` объединяет табличный список, канбан-доску и календарный виджет напоминаний с единым состоянием выбора.
- Шапка задач содержит фильтры по статусу, исполнителю, типу и тегам, а также переключатель между табличным и канбан-представлением.
- Zustand-хранилище `useTasksViewStore` сохраняет выбранный режим просмотра и активные фильтры по датам.
- Панель массовых действий поддерживает смену статуса, переназначение исполнителя и перенос сроков для выбранных задач.
- Календарь (неделя/месяц) подсвечивает дни с напоминаниями и передаёт выбранный диапазон в фильтрацию списка.

## Требования к доступности
- Формы и таблицы имеют связи `label`/`for`, подсказки озвучиваются screen reader'ом.
- Фильтры управляются клавиатурой, состояние чекбоксов/переключателей озвучивается.
- Для канбан-доски реализована альтернатива списком, доступным для screen reader.
- Уведомления о дедлайнах доступны через ARIA live region.

## Отложенные возможности
- Экспорт списка задач в XLSX/CSV.
- Синхронизация календаря с внешними системами через WebCal.
- Расширенный календарь с квартальными/годовыми обзорами и внешними подписками.
