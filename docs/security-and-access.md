# Правила безопасности и доступа

Документ описывает упрощённую модель доступа: базовую защиту персональных данных и операций без обязательного соответствия отраслевым регуляторным нормам. Основной упор делается на ролевое разграничение прав, аудит действий и прозрачность процедур выдачи доступа.

## Обзор ролей и операций

Упрощённая модель доступа предполагает один уровень разрешений: если у роли есть доступ к сущности, она может просматривать и изменять данные в рамках закреплённых за ней клиентов и сделок. Комбинации ролей не применяются, каждому пользователю назначается ровно одна роль.

| Сущность/операция | Продавец | Исполнитель | Главный админ |
| --- | --- | --- | --- |
| Клиенты | Доступ к своим клиентам | Доступ к клиентам по назначенным сделкам | Полный доступ |
| Сделки и журнал | Доступ к своим сделкам | Доступ к назначенным сделкам | Полный доступ |
| Документы | Доступ к папкам своих сделок | Доступ к папкам назначенных сделок | Полный доступ |
| Полисы | Доступ к полисам своих сделок | Доступ к полисам назначенных сделок | Полный доступ |
| Платежи и cashflow | Доступ к платежам и позициям доходов/расходов своих сделок | Доступ к платежам и позициям доходов/расходов назначенных сделок | Полный доступ |
| Задачи | Доступ к задачам своих сделок | Доступ к назначенным задачам | Полный доступ |
| Отчёты и метрики | Персональные базовые выгрузки | Нет доступа | Полный доступ |
| Управление пользователями | Нет доступа | Нет доступа | Полный доступ |

**Примечания:**
- Все операции журналируются в сервисе [Audit](tech-stack.md#audit), включая действия по документам и платежам.

## Доступ к ключевым ресурсам

### Папки Google Drive
- **Пользователь**: автоматически получает доступ к корневой папке клиента и вложенным папкам сделок, где состоит команда; может загружать, обновлять и удалять файлы в пределах своих объектов.
- **Главный админ**: управляет всей структурой папок, правами совместного доступа и служебными настройками интеграции с Drive.

Документы уровня клиента (например, анкеты, договоры на обслуживание, доверенности) хранятся непосредственно в корне папки клиента; все остальные файлы располагаются внутри папок сделок и полисов.

### Журнал сделки
- **Пользователь**: создаёт и редактирует записи в журналах сделок, где состоит команда, включая фиксацию ключевых событий и комментариев.
- **Главный админ**: имеет полный доступ для аудита, восстановления записей и технической поддержки.

### Платежи
- **Продавец**: вводит и редактирует фактические данные по платежам своих сделок (включая направление, назначение, комментарий), а также управляет связанными позициями доходов и расходов в рамках подтверждённых записей.
- **Исполнитель**: актуализирует фактические даты, суммы и структуру доходов/расходов по назначенным сделкам (например, распределяет комиссию между коллегами) в модуле платежей CRM.
- **Главный админ**: обладает полным доступом к модулю платежей CRM, подтверждает операции, корректирует структуру доходов/расходов, формирует выгрузки и может блокировать редактирование спорных записей через административные сценарии.

## Процедуры выдачи и отзыва доступа

1. **Создание учётной записи**
   - Главный админ заводит пользователя в Auth, присваивает роль «пользователь» или «главный админ» и фиксирует действие в журнале.
   - Auth-сервис синхронизирует роль с Documents и другими сервисами; автоматически выдаются базовые права авторизации.

2. **Назначение пользователя в сделку**
   - Ведущий пользователь оформляет заявку на подключение коллеги к сделке через CRM.
   - Главный админ подтверждает заявку и добавляет пользователя в команду сделки.
   - После подтверждения CRM/Deals уведомляет Auth и Documents, что запускает автоматическую выдачу доступа к папкам, журналу и платежам сделки.

3. **Переназначение ответственности внутри сделки**
   - Пользователь, ведущий сделку, обновляет роли участников (например, кто ведёт расчёты или финконтроль) в карточке сделки.
   - Система сохраняет изменения в [Audit](tech-stack.md#audit) и уведомляет команду; права остаются на уровне универсальной роли «пользователь».

4. **Удаление пользователя из сделки**
   - Ведущий пользователь инициирует действие «Удалить участника» в CRM и уведомляет главного админа.
   - Главный админ подтверждает удаление; CRM, Auth и Documents мгновенно прекращают доступ к журналу, папкам и платежам сделки.
   - История действий остаётся в системе для аудита.

5. **Блокировка или увольнение**
   - Главный админ блокирует пользователя в Auth, что мгновенно отключает все сессии и доступы.
   - Documents удаляет пользователя из всех общих папок Google Drive, а CRM внутри собственных модулей переназначает связанные задачи и уведомления на ведущего пользователя или нового ответственного.

6. **Периодический пересмотр доступа**
   - Ежеквартально главный админ совместно с владельцами процессов сверяет активные аккаунты, состав команд по сделкам и актуальность заявок на доступ.
   - Результаты сверки фиксируются в отчёте и в [Audit](tech-stack.md#audit); лишние доступы немедленно отзываются.

Эти правила обеспечивают согласованное управление доступами во всех сервисах системы и минимизируют риск утечек данных.
