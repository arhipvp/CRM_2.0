# Правила безопасности и доступа

Документ описывает упрощённую модель доступа: базовую защиту персональных данных и операций без соблюдения специальных отраслевых регуляторных требований. Основной упор делается на ролевое разграничение прав, аудит действий и прозрачность процедур выдачи доступа.

## Обзор ролей и операций

Упрощённая модель доступа предполагает один уровень разрешений: если у роли есть доступ к сущности, она может просматривать и изменять данные в рамках закреплённых за ней клиентов и сделок. Комбинации ролей не применяются, каждому пользователю назначается ровно одна роль.

| Сущность/операция | Пользователь | Администратор |
| --- | --- | --- |
| Клиенты | Создаёт и ведёт клиентов, где назначен ответственным; видит клиентов, связанные с его сделками. | Полный доступ ко всем клиентам и журналам изменений. |
| Сделки и журнал | Создаёт сделки, управляет журналом и составом команды в пределах своих сделок. | Полный доступ ко всем сделкам и журналам. |
| Документы | Управляет файлами в папках клиентов и сделок, где состоит команда пользователя. | Полный доступ ко всей структуре Drive и настройкам прав. |
| Полисы | Создаёт и редактирует полисы в рамках своих сделок. | Полный доступ ко всем полисам. |
| Платежи | Создаёт, редактирует и подтверждает платежи в назначенных сделках. | Полный доступ ко всем платежам и настройкам интеграций. |
| Задачи | Создаёт и ведёт задачи по своим сделкам, переназначает коллег и контролирует сроки. | Полный доступ ко всем задачам для аудита. |
| Отчёты и метрики | Видит операционные отчёты по своим сделкам и персональные метрики. | Доступ ко всем отчётам и настройкам аналитики. |
| Управление пользователями | Нет доступа. | Полный доступ. |

**Примечания:**
- Все операции журналируются в сервисе Audit, включая действия по документам и платежам.

## Доступ к ключевым ресурсам

### Папки Google Drive
- **Пользователь**: автоматически получает доступ к корневой папке клиента и вложенным папкам сделок, где состоит команда; может загружать, обновлять и удалять файлы в пределах своих объектов.
- **Администратор**: управляет всей структурой папок, правами совместного доступа и служебными настройками интеграции с Drive.

Документы уровня клиента (например, анкеты, договоры на обслуживание, доверенности) хранятся непосредственно в корне папки клиента; все остальные файлы располагаются внутри папок сделок и полисов.

### Журнал сделки
- **Пользователь**: создаёт и редактирует записи в журналах сделок, где состоит команда, включая фиксацию ключевых событий и комментариев.
- **Администратор**: имеет полный доступ для аудита, восстановления записей и технической поддержки.

### Платежи
- **Пользователь**: создаёт и обновляет записи по всем типам платежей в рамках своих сделок, подтверждает статусы и добавляет пояснения. Команда самостоятельно распределяет, кто отвечает за финансовый контроль, но права остаются едиными.
- **Администратор**: выполняет аудит операций, помогает при спорных ситуациях и управляет системными настройками платежного сервиса.

## Процедуры выдачи и отзыва доступа

1. **Создание учётной записи**
   - Администратор заводит пользователя в Auth, присваивает роль «пользователь» или «администратор» и фиксирует действие в журнале.
   - Auth-сервис синхронизирует роль с Documents и другими сервисами; автоматически выдаются базовые права авторизации.

2. **Назначение пользователя в сделку**
   - Ведущий пользователь оформляет заявку на подключение коллеги к сделке через CRM.
   - Администратор подтверждает заявку и добавляет пользователя в команду сделки.
   - После подтверждения CRM/Deals уведомляет Auth и Documents, что запускает автоматическую выдачу доступа к папкам, журналу и платежам сделки.

3. **Переназначение ответственности внутри сделки**
   - Пользователь, ведущий сделку, обновляет роли участников (например, кто ведёт расчёты или финконтроль) в карточке сделки.
   - Система сохраняет изменения в Audit и уведомляет команду; права остаются на уровне универсальной роли «пользователь».

4. **Удаление пользователя из сделки**
   - Ведущий пользователь инициирует действие «Удалить участника» в CRM и уведомляет администратора.
   - Администратор подтверждает удаление; CRM, Auth и Documents мгновенно прекращают доступ к журналу, папкам и платежам сделки.
   - История действий остаётся в системе для аудита.

5. **Блокировка или увольнение**
   - Администратор блокирует пользователя в Auth, что мгновенно отключает все сессии и доступы.
   - Documents удаляет пользователя из всех общих папок Google Drive, а CRM и Payments переназначают открытые задачи и напоминания на ведущего пользователя или нового ответственного.

6. **Периодический пересмотр доступа**
   - Ежеквартально администратор совместно с владельцами процессов сверяет активные аккаунты, состав команд по сделкам и актуальность заявок на доступ.
   - Результаты сверки фиксируются в отчёте и в Audit; лишние доступы немедленно отзываются.

Эти правила обеспечивают согласованное управление доступами во всех сервисах системы и минимизируют риск утечек данных.
