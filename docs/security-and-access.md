# Правила безопасности и доступа

Документ описывает упрощённую модель доступа: базовую защиту персональных данных и операций без обязательного соответствия отраслевым регуляторным нормам. Основной упор делается на ролевое разграничение прав, аудит действий и прозрачность процедур выдачи доступа.

## Обзор ролей и операций

Упрощённая модель доступа предполагает один уровень разрешений: если у роли есть доступ к сущности, она может просматривать и изменять данные в рамках закреплённых за ней клиентов и сделок. Комбинации ролей не применяются, каждому пользователю назначается ровно одна роль.

| Сущность/операция | Продавец | Исполнитель | Финансовый менеджер | Руководитель | Администратор |
| --- | --- | --- | --- | --- | --- |
| Клиенты | Доступ к своим клиентам | Доступ к клиентам по назначенным сделкам | Доступ ко всем клиентам | Доступ ко всем клиентам | Полный доступ |
| Сделки и журнал | Доступ к своим сделкам | Доступ к назначенным сделкам | Доступ ко всем сделкам | Доступ ко всем сделкам | Полный доступ |
| Документы | Доступ к папкам своих сделок | Доступ к папкам назначенных сделок | Доступ к документам по платежам и актам | Доступ к документам всех сделок | Полный доступ |
| Полисы | Доступ к полисам своих сделок | Доступ к полисам назначенных сделок | Доступ ко всем полисам | Доступ ко всем полисам | Полный доступ |
| Платежи | Доступ к платежам своих сделок | Доступ к платежам назначенных сделок | Полный доступ | Доступ ко всем платежам | Полный доступ |
| Задачи | Доступ к задачам своих сделок | Доступ к назначенным задачам | Управление задачами по платежам | Доступ ко всем задачам | Полный доступ |
| Отчёты и метрики | Персональные базовые выгрузки | Нет доступа | Базовые финансовые выгрузки | Базовые отчёты (по мере появления) | Полный доступ |
| Управление пользователями | Нет доступа | Нет доступа | Нет доступа | Нет доступа | Полный доступ |

**Примечания:**
- Все операции журналируются в сервисе Audit, включая действия по документам и платежам.

## Доступ к ключевым ресурсам

### Папки Google Drive
- **Пользователь**: автоматически получает доступ к корневой папке клиента и вложенным папкам сделок, где состоит команда; может загружать, обновлять и удалять файлы в пределах своих объектов.
- **Администратор**: управляет всей структурой папок, правами совместного доступа и служебными настройками интеграции с Drive.

Документы уровня клиента (например, анкеты, договоры на обслуживание, доверенности) хранятся непосредственно в корне папки клиента; все остальные файлы располагаются внутри папок сделок и полисов.

### Журнал сделки
- **Пользователь**: создаёт и редактирует записи в журналах сделок, где состоит команда, включая фиксацию ключевых событий и комментариев.
- **Администратор**: имеет полный доступ для аудита, восстановления записей и технической поддержки.

### Платежи
- **Продавец**: заводит и обновляет записи по комиссиям и выплатам в рамках своих сделок до момента проверки финансами.
- **Исполнитель**: управляет платежами назначенных сделок, включая обновление сумм, статусов и служебных комментариев.
- **Финансовый менеджер**: обладает полным доступом к платежам, подтверждает операции, вносит корректировки и формирует базовые выгрузки.
- **Руководитель**: контролирует состояние всех платежей, может корректировать статусы и инициировать необходимые правки.
- **Администратор**: имеет полный доступ для аудита и технической поддержки процессов.

## Процедуры выдачи и отзыва доступа

1. **Создание учётной записи**
   - Администратор заводит пользователя в Auth, присваивает роль «пользователь» или «администратор» и фиксирует действие в журнале.
   - Auth-сервис синхронизирует роль с Documents и другими сервисами; автоматически выдаются базовые права авторизации.

2. **Назначение пользователя в сделку**
   - Ведущий пользователь оформляет заявку на подключение коллеги к сделке через CRM.
   - Администратор подтверждает заявку и добавляет пользователя в команду сделки.
   - После подтверждения CRM/Deals уведомляет Auth и Documents, что запускает автоматическую выдачу доступа к папкам, журналу и платежам сделки.

3. **Переназначение ответственности внутри сделки**
   - Пользователь, ведущий сделку, обновляет роли участников (например, кто ведёт расчёты или финконтроль) в карточке сделки.
   - Система сохраняет изменения в Audit и уведомляет команду; права остаются на уровне универсальной роли «пользователь».

4. **Удаление пользователя из сделки**
   - Ведущий пользователь инициирует действие «Удалить участника» в CRM и уведомляет администратора.
   - Администратор подтверждает удаление; CRM, Auth и Documents мгновенно прекращают доступ к журналу, папкам и платежам сделки.
   - История действий остаётся в системе для аудита.

5. **Блокировка или увольнение**
   - Администратор блокирует пользователя в Auth, что мгновенно отключает все сессии и доступы.
   - Documents удаляет пользователя из всех общих папок Google Drive, а CRM и Payments переназначают открытые задачи и напоминания на ведущего пользователя или нового ответственного.

6. **Периодический пересмотр доступа**
   - Ежеквартально администратор совместно с владельцами процессов сверяет активные аккаунты, состав команд по сделкам и актуальность заявок на доступ.
   - Результаты сверки фиксируются в отчёте и в Audit; лишние доступы немедленно отзываются.

Эти правила обеспечивают согласованное управление доступами во всех сервисах системы и минимизируют риск утечек данных.
