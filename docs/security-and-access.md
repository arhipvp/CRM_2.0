# Правила безопасности и доступа

Документ описывает упрощённую модель доступа: базовую защиту персональных данных и операций без обязательного соответствия отраслевым регуляторным нормам. Основной упор делается на ролевое разграничение прав, аудит действий и прозрачность процедур выдачи доступа.

## Обзор ролей и операций

Упрощённая модель доступа предполагает один уровень разрешений: если у роли есть доступ к сущности, она может просматривать и изменять данные в рамках закреплённых за ней клиентов и сделок. Комбинации ролей не применяются, каждому пользователю назначается ровно одна роль.

| Сущность/операция | Продавец | Исполнитель | Финансовый менеджер | Руководитель | Администратор |
| --- | --- | --- | --- | --- | --- |
| Клиенты | Доступ к своим клиентам | Доступ к клиентам по назначенным сделкам | Доступ ко всем клиентам | Доступ ко всем клиентам | Полный доступ |
| Сделки и журнал | Доступ к своим сделкам | Доступ к назначенным сделкам | Доступ ко всем сделкам | Доступ ко всем сделкам (только чтение) | Полный доступ |
| Документы | Доступ к папкам своих сделок | Доступ к папкам назначенных сделок | Доступ к документам по платежам и актам | Доступ к документам всех сделок (только чтение) | Полный доступ |
| Полисы | Доступ к полисам своих сделок | Доступ к полисам назначенных сделок | Доступ ко всем полисам | Просмотр всех полисов | Полный доступ |
| Платежи | Доступ к платежам своих сделок | Просмотр платежей назначенных сделок | Полный доступ | Просмотр всех платежей | Полный доступ |
| Задачи | Доступ к задачам своих сделок | Доступ к назначенным задачам | Просмотр задач по платежам | Просмотр задач | Полный доступ |
| Отчёты и метрики | Персональные отчёты | Нет доступа | Финансовые отчёты | Все отчёты | Все отчёты |
| Управление пользователями | Нет доступа | Нет доступа | Нет доступа | Нет доступа | Полный доступ |

**Примечания:**
- Руководитель и другие роли с пометкой «только чтение» не могут изменять данные, но видят их полностью.
- Все операции журналируются в сервисе Audit.

## Доступ к ключевым ресурсам

### Папки Google Drive
- **Продавец**: автоматический доступ к корневой папке клиента и всем вложенным папкам своих сделок; может загружать и обновлять файлы в этой области.
- **Исполнитель**: доступ к папкам сделок, где назначен, включая дочерние папки полисов; работы за пределами назначенных сделок не выполняет.
- **Финансовый менеджер**: доступ к документам, связанным с платежами и актами, исключительно для чтения и сверки.
- **Руководитель**: доступ только на чтение ко всем папкам сделок для контроля хода работы.
- **Администратор**: полный доступ ко всей структуре и правам совместного доступа.

Документы уровня клиента (например, анкеты, договора на обслуживание, доверенности) хранятся непосредственно в корне папки клиента; все остальные файлы располагаются внутри папок сделок и полисов.

### Журнал сделки
- **Продавец**: создаёт и редактирует записи в журналах своих сделок.
- **Исполнитель**: дополняет журнал по назначенным сделкам техническими комментариями.
- **Финансовый менеджер**: просматривает журнал сделок для проверки контекста платежей.
- **Руководитель**: читает журналы всех сделок, чтобы отслеживать прогресс команды.
- **Администратор**: имеет полный доступ, включая техническое администрирование и архивирование записей.

### Платежи
- **Продавец**: заводит и обновляет записи по комиссиям и выплатам в рамках своих сделок до момента проверки финансами.
- **Исполнитель**: отслеживает платежи своих сделок и фиксирует служебные комментарии без права менять суммы и статусы.
- **Финансовый менеджер**: обладает полным доступом к платежам, подтверждает операции, вносит корректировки и формирует отчёты.
- **Руководитель**: просматривает состояние всех платежей без возможности их изменить.
- **Администратор**: имеет полный доступ для аудита и технической поддержки процессов.

## Процедуры выдачи и отзыва доступа

1. **Назначение роли новому пользователю**
   - Администратор создаёт учётную запись, присваивает одну из стандартных ролей и фиксирует это в журнале изменений.
   - Auth-сервис синхронизирует роль с Documents и другими сервисами; автоматически выдаются соответствующие права к папкам, журналам и платежам.

2. **Добавление участника в сделку**
   - Ответственный за сделку (обычно продавец) инициирует назначение исполнителя или финансового менеджера.
   - CRM/Deals уведомляет Auth и Documents о новых участниках, что запускает автоматическую выдачу доступа к папкам и журналу сделки.
   - Уведомление отправляется участнику с перечнем полученных доступов.

3. **Смена роли пользователя**
   - Администратор заменяет действующую роль пользователя на новую в Auth.
   - Система автоматически отзывает старые доступы и выдаёт набор разрешений, соответствующий новой роли (папки Drive, журналы, платежи, отчёты).
   - Изменения фиксируются в Audit; участник получает уведомление о новых правах.

4. **Вывод участника из сделки**
   - Ответственный за сделку инициирует действие «Удалить участника» в CRM.
   - CRM отправляет событие в Auth/Documents/Payments для немедленного прекращения доступа к журналу, папкам и платежам данной сделки.
   - История действий участника остаётся в системе, но новые записи создаёт уже другой назначенный пользователь.

5. **Отзыв прав при увольнении или блокировке**
   - Администратор блокирует пользователя в Auth, что мгновенно отключает все сессии и доступы.
   - Documents удаляет пользователя из всех общих папок в Google Drive.
   - Payments и CRM закрывают все задачи и напоминания, переназначая на руководителя или нового исполнителя.

6. **Периодический пересмотр прав**
   - Ежеквартально руководитель и администратор проводят сверку активных ролей и доступов.
   - Результаты сверки фиксируются в отчёте и в Audit.

Эти правила обеспечивают согласованное управление доступами во всех сервисах системы и минимизируют риск утечек данных.
