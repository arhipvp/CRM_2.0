# Архитектура Telegram-бота

## Назначение сервиса
Telegram-бот обеспечивает мобильный доступ продавцов и исполнителей к ключевым функциям CRM: получение уведомлений, подтверждение задач и запуск быстрых сценариев создания сделки.

## Интеграции
- **Notifications (RabbitMQ)** — передача очереди событий и статусов доставки уведомлений через единый брокер RabbitMQ.
- **CRM/Deals** — создание черновиков сделок, дополнение журналов, запрос контекстной информации для ответов пользователю.
- **Auth** — проверка связки Telegram-аккаунта с пользователем и его ролями, выдача временных токенов для операций.

## Сценарии
1. **Быстрая сделка**: продавец вызывает команду `/new_deal`, бот запрашивает основные параметры и создаёт черновик сделки в CRM.
2. **Напоминание о задаче**: при получении события бот отправляет уведомление, пользователь может подтвердить выполнение или запросить перенос срока.
3. **Платёжный контроль**: бот сообщает о приближающихся платежах, направляет задачу продавцу с возможностью подтвердить оплату и уведомляет главного админа при необходимости эскалации.

## Технические детали
- Вебхук Telegram размещён за Gateway/BFF и передаёт события в сервис бота через защищённый канал.
- Очередь сообщений реализуется на базе брокера RabbitMQ и используется совместно с Notifications.
- Хранение состояния диалогов минимально и ограничено активными сценариями, чтобы не дублировать CRM.

