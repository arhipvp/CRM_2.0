# Миграции схемы `auth`

## Порядок миграций

1. `20240115090000_create_auth_core.sql` — создаёт таблицы `users`, `roles`, `user_roles` и базовые ограничения.
2. `20240115100000_create_oauth_clients.sql` — добавляет `oauth_clients` и связанные внешние ключи.
3. `20240115103000_create_sessions_and_tokens.sql` — создаёт `oauth_sessions` и `tokens`, настраивает индексы по токенам и времени жизни.
4. `20240115110000_seed_default_roles.sql` — заполняет справочник ролей и создаёт системного пользователя.

Дополнительные миграции размещаются в каталоге согласно хронологии: сначала изменения структуры, затем данные.

## Правила версионирования

* Имена файлов — UTC-штампы в формате `YYYYMMDDHHMMSS_описание.sql`.
* Каждый SQL-скрипт должен быть идемпотентным или сопровождаться проверками на существование объектов.
* Изменения структуры (DDL) и данных (DML) разделяются по разным файлам.
* При добавлении новой функциональности сначала расширяется доменная модель в `docs/`, затем добавляются миграции.
