# Миграции схемы `crm`

## Порядок миграций

1. `20240116080000_create_clients.sql` — таблицы `clients` и `client_contacts`, индексы по статусу и типу.
2. `20240116083000_create_deals.sql` — создаёт `deals` и `deal_journal`, настраивает внешние ключи на `auth.users`.
3. `20240116090000_create_calculations.sql` — таблица `calculations` с привязкой к сделкам.
4. `20240116093000_create_policies.sql` — таблица `policies`, уникальный индекс по `policy_number`.
5. `20240116100000_create_policy_documents.sql` — таблица `policy_documents` с внешними ключами на схему `documents`.
6. `20240116103000_seed_crm_dictionaries.sql` — статусы сделок и полисов, типы клиентов.

## Правила версионирования

* Файлы именуются по формату `YYYYMMDDHHMMSS_описание.sql` (UTC).
* В одной миграции изменяется только одна логическая группа объектов.
* При удалении колонок сначала фиксируется миграция переноса данных, затем миграция удаления.
* Все внешние ключи должны сопровождаться индексами, описанными в `docs/data-model.md`.
