[bootstrap-local] → Проверка зависимостей
[bootstrap-local] Используем интерпретатор Python: python
[bootstrap-local][предупреждение] Команда 'psql' не найдена. Отсутствует локальный CLI PostgreSQL — скрипты будут пытаться использовать docker compose exec.
[bootstrap-local][предупреждение] Команда 'redis-cli' не найдена. Для локальных проверок Redis используйте docker compose exec redis redis-cli.
[bootstrap-local] → Синхронизация .env
Источник: /c/Dev/CRM_2.0/env.example
[Пропуск] .env уже существует (режим skip-existing)
[Пропуск] backend/gateway/.env уже существует (режим skip-existing)
[Пропуск] backend/auth/.env уже существует (режим skip-existing)
[Пропуск] backend/crm/.env уже существует (режим skip-existing)
[Пропуск] backend/documents/.env уже существует (режим skip-existing)
[Пропуск] backend/reports/.env уже существует (режим skip-existing)
Готово. Не забудьте обновить чувствительные данные (пароли, токены) в скопированных файлах.
[bootstrap-local] → Проверка портов .env
[bootstrap-local] → docker compose up -d
 Network infra_infra  Creating
 Network infra_infra  Created
 Volume infra_pgadmin_data  Creating
 Volume infra_pgadmin_data  Created
 Volume infra_postgres_data  Creating
 Volume infra_postgres_data  Created
 Volume infra_redis_data  Creating
 Volume infra_redis_data  Created
 Volume infra_consul_data  Creating
 Volume infra_consul_data  Created
 Container crm-postgres  Creating
 Container crm-redis  Creating
 Container crm-consul  Creating
 Container crm-rabbitmq  Creating
 Container crm-rabbitmq  Created
 Container crm-redis  Created
 Container crm-postgres  Created
 Container crm-pgadmin  Creating
 Container crm-backup  Creating
 Container crm-consul  Created
 Container crm-pgadmin  Created
 Container crm-backup  Created
 Container crm-redis  Starting
 Container crm-postgres  Starting
 Container crm-rabbitmq  Starting
 Container crm-consul  Starting
 Container crm-redis  Started
 Container crm-rabbitmq  Started
 Container crm-consul  Started
 Container crm-postgres  Started
 Container crm-postgres  Waiting
 Container crm-rabbitmq  Waiting
 Container crm-postgres  Waiting
 Container crm-postgres  Error
 Container crm-postgres  Error
 Container crm-rabbitmq  Healthy
dependency failed to start: container crm-postgres is unhealthy
[bootstrap-local][ошибка] Шаг 'docker compose up -d' завершился с кодом 1. См. лог: ./.local/logs/bootstrap/run-20251028-025618/steps/04_docker_compose_up_-d.log
[bootstrap-local] → Ожидание готовности docker compose
Команда 'docker compose wait' недоступна, включён ручной мониторинг статусов
NAME           IMAGE                      COMMAND                  SERVICE    CREATED          STATUS                    PORTS
crm-consul     hashicorp/consul:1.16      "docker-entrypoint.s…"   consul     55 seconds ago   Up 50 seconds (healthy)   0.0.0.0:8500->8500/tcp, [::]:8500->8500/tcp, 0.0.0.0:8502->8502/tcp, [::]:8502->8502/tcp, 0.0.0.0:8600->8600/udp, [::]:8600->8600/udp
crm-postgres   postgres:15-alpine         "docker-entrypoint.s…"   postgres   55 seconds ago   Up 15 seconds (healthy)   0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp
crm-rabbitmq   rabbitmq:3.12-management   "docker-entrypoint.s…"   rabbitmq   55 seconds ago   Up 50 seconds (healthy)   0.0.0.0:5672->5672/tcp, [::]:5672->5672/tcp, 0.0.0.0:15672->15672/tcp, [::]:15672->15672/tcp
crm-redis      redis:7-alpine             "docker-entrypoint.s…"   redis      55 seconds ago   Up 50 seconds (healthy)   0.0.0.0:6379->6379/tcp, [::]:6379->6379/tcp
Контейнеры готовы.
[bootstrap-local] → Bootstrap RabbitMQ
[Инфо] Пропускаем переменную BACKUP_RABBITMQ_URL: комбинация crm@crm уже получена из RABBITMQ_DEFAULT_USER.
[Инфо] Пропускаем переменную CRM_RABBITMQ_URL: комбинация crm@crm уже получена из RABBITMQ_DEFAULT_USER.
[Инфо] Найдены комбинации пользователей RabbitMQ и vhost:
  RABBITMQ_DEFAULT_USER -> crm@crm
  TELEGRAM_BOT_RABBITMQ_URL -> telegram@telegram
[Инфо] Контейнер RabbitMQ уже запущен.
[Инфо] Ожидаем готовность RabbitMQ (healthcheck)...
[Инфо] RabbitMQ готов (state='running', health='healthy').
[Инфо] Проверяем запуск узла RabbitMQ (rabbitmqctl await_startup)...
Still booting, will check again in 10 seconds...
Still booting, will check again in 10 seconds...
Still booting, will check again in 10 seconds...
Still booting, will check again in 10 seconds...
Still booting, will check again in 10 seconds...
Still booting, will check again in 10 seconds...
[Инфо] Узел RabbitMQ готов к выполнению команд rabbitmqctl (await_startup).
==> Обработка пользователя 'crm' и vhost 'crm'
  • vhost 'crm' уже существует
Changing password for user "crm" ...
  • обновлён пароль пользователя 'crm'
Setting permissions for user "crm" in vhost "crm" ...
  • подтверждены права 'crm' на vhost 'crm'
==> Обработка пользователя 'telegram' и vhost 'telegram'
Adding vhost "telegram" ...
  • создан vhost 'telegram'
Adding user "telegram" ...
Done. Don't forget to grant the user permissions to some virtual hosts! See 'rabbitmqctl help set_permissions' to learn more.
  • создан пользователь 'telegram'
Setting permissions for user "telegram" in vhost "telegram" ...
  • подтверждены права 'telegram' на vhost 'telegram'
\nГотово: проверено 2 комбинаций пользователь/vhost.
[bootstrap-local] → Миграции CRM/Auth
[migrate-local] Применяем миграции CRM (Alembic)...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 1 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 2 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 3 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 4 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 5 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 6 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 7 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 8 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 9 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Dev\CRM_2.0\.venv\Scripts\alembic.exe\__main__.py", line 7, in <module>
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\config.py", line 946, in run_cmd
    fn(
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\command.py", line 483, in upgrade
    script.run_env()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\script\base.py", line 545, in run_env
    util.load_python_file(self.dir, "env.py")
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\alembic\util\pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 66, in <module>
    run_migrations_online()
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 49, in run_migrations_online
    asyncio.run(do_run_migrations())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\backend\crm\migrations\env.py", line 45, in do_run_migrations
    async with connectable.connect() as connection:
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\engine.py", line 275, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connection.py", line 2329, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 991, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 828, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Dev\CRM_2.0\.venv\Lib\site-packages\asyncpg\connect_utils.py", line 876, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "crm"
[migrate-local] Попытка 10 из 10: Миграции CRM не удались. Повторная попытка через 5 секунд...
[migrate-local] Ошибка: Миграции CRM не удалось применить после 10 попыток.
[bootstrap-local][ошибка] Шаг 'Миграции CRM/Auth' завершился с кодом 1. См. лог: ./.local/logs/bootstrap/run-20251028-025618/steps/07__CRM_Auth.log
[bootstrap-local] → Smoke-проверка BACKUP_*
[bootstrap-local] BACKUP_S3_* переменные отсутствуют или пусты — будет использован DummyStorage.
[bootstrap-local] → Smoke-проверка backup без S3
[bootstrap-local] BACKUP_S3_* пусты — проверяем, что контейнер backup работает в режиме DummyStorage.
[bootstrap-local][ошибка] Контейнер backup не запущен (docker compose ps -q вернул пустой результат).
[bootstrap-local][ошибка] Шаг 'Smoke-проверка backup без S3' завершился с кодом 1. См. лог: ./.local/logs/bootstrap/run-20251028-025618/steps/09_Smoke-_backup_S3.log
[bootstrap-local] → Запуск backend-профиля
[bootstrap-local] Пересборка образов профиля backend перед запуском
#1 [internal] load local bake definitions
#1 reading from stdin 2.52kB 0.2s done
#1 DONE 0.2s

#2 [crm internal] load build definition from python-poetry-service.Dockerfile
#2 transferring dockerfile:
#2 ...

#3 [gateway internal] load build definition from Dockerfile.gateway
#3 transferring dockerfile: 636B 0.2s done
#3 DONE 0.6s

#2 [crm internal] load build definition from python-poetry-service.Dockerfile
#2 ...

#4 [auth internal] load build definition from spring-boot-service.Dockerfile
#4 transferring dockerfile: 588B 0.3s done
#4 DONE 0.7s

#2 [crm internal] load build definition from python-poetry-service.Dockerfile
#2 transferring dockerfile: 1.36kB 0.4s done
#2 DONE 0.9s

#5 [documents internal] load build definition from node-service.Dockerfile
#5 transferring dockerfile: 1.20kB 0.3s done
#5 DONE 0.8s

#6 [documents] resolve image config for docker-image://docker.io/docker/dockerfile:1.5
#6 ...

#7 [backup internal] load build definition from Dockerfile
#7 transferring dockerfile: 394B 0.4s done
#7 DONE 1.2s

#6 [crm] resolve image config for docker-image://docker.io/docker/dockerfile:1.5
#6 ...

#8 [auth] docker/dockerfile:pull token for registry-1.docker.io
#8 DONE 0.0s

#9 [backup internal] load metadata for docker.io/library/python:3.11-slim
#9 ...

#10 [auth] library/python:pull token for registry-1.docker.io
#10 DONE 0.0s

#6 [crm] resolve image config for docker-image://docker.io/docker/dockerfile:1.5
#6 DONE 4.1s

#11 [gateway] docker-image://docker.io/docker/dockerfile:1.5@sha256:39b85bbfa7536a5feceb7372a0817649ecb2724562a38360f4d6a7782a409b14
#11 CACHED

#9 [backup internal] load metadata for docker.io/library/python:3.11-slim
#9 DONE 4.0s

#12 [backup internal] load .dockerignore
#12 transferring context:
#12 transferring context: 2B 0.2s done
#12 DONE 0.7s

#13 [backup internal] load build context
#13 DONE 0.0s

#14 [backup 1/5] FROM docker.io/library/python:3.11-slim@sha256:8eb5fc663972b871c528fef04be4eaa9ab8ab4539a5316c4b8c133771214a617
#14 resolve docker.io/library/python:3.11-slim@sha256:8eb5fc663972b871c528fef04be4eaa9ab8ab4539a5316c4b8c133771214a617
#14 resolve docker.io/library/python:3.11-slim@sha256:8eb5fc663972b871c528fef04be4eaa9ab8ab4539a5316c4b8c133771214a617 0.2s done
#14 DONE 0.3s

#13 [backup internal] load build context
#13 transferring context: 996B 0.2s done
#13 DONE 0.7s

#15 [backup 3/5] COPY pyproject.toml README.md ./
#15 CACHED

#16 [backup 4/5] COPY backup ./backup
#16 CACHED

#17 [backup 2/5] WORKDIR /app
#17 CACHED

#18 [backup 5/5] RUN pip install --no-cache-dir --upgrade pip     && pip install --no-cache-dir .
#18 CACHED

#19 [backup] exporting to image
#19 exporting layers done
#19 writing image sha256:3110afd8963f7df6f54f8e94bea2fb9ab9afc6555e0b777e137da9a66fa73465 0.1s done
#19 naming to docker.io/library/infra-backup 0.0s done
#19 DONE 0.1s

#20 [backup] resolving provenance for metadata file
#20 DONE 0.2s

#21 [documents internal] load build definition from node-service.Dockerfile
#21 transferring dockerfile: 43B 0.1s
#21 transferring dockerfile: 1.20kB 0.3s done
#21 ...

#22 [documents internal] load .dockerignore
#22 transferring context: 2B 0.2s done
#22 DONE 0.5s

#23 [auth internal] load build definition from spring-boot-service.Dockerfile
#23 transferring dockerfile: 588B 0.3s done
#23 ...

#24 [gateway internal] load .dockerignore
#24 DONE 0.0s

#25 [auth internal] load .dockerignore
#25 transferring context: 2B 0.3s done
#25 DONE 1.0s

#21 [documents internal] load build definition from node-service.Dockerfile
#21 DONE 1.1s

#26 [crm internal] load build definition from python-poetry-service.Dockerfile
#26 transferring dockerfile: 1.36kB 0.9s done
#26 DONE 1.2s

#23 [auth internal] load build definition from spring-boot-service.Dockerfile
#23 DONE 1.1s

#27 [crm internal] load .dockerignore
#27 transferring context: 2B 0.5s done
#27 DONE 1.1s

#28 [documents internal] load metadata for docker.io/library/node:20-alpine
#28 ...

#24 [gateway internal] load .dockerignore
#24 transferring context: 2B 0.3s done
#24 DONE 0.7s

#9 [crm internal] load metadata for docker.io/library/python:3.11-slim
#9 DONE 4.9s

#29 [gateway internal] load metadata for docker.io/library/node:18-alpine
#29 ...

#30 [auth] library/node:pull token for registry-1.docker.io
#30 DONE 0.0s

#31 [auth] library/eclipse-temurin:pull token for registry-1.docker.io
#31 DONE 0.0s

#32 [auth] library/gradle:pull token for registry-1.docker.io
#32 DONE 0.0s

#33 [auth internal] load metadata for docker.io/library/gradle:8.8-jdk21-alpine
#33 ...

#34 [crm internal] load build context
#34 DONE 0.0s

#14 [crm base 1/3] FROM docker.io/library/python:3.11-slim@sha256:8eb5fc663972b871c528fef04be4eaa9ab8ab4539a5316c4b8c133771214a617
#14 resolve docker.io/library/python:3.11-slim@sha256:8eb5fc663972b871c528fef04be4eaa9ab8ab4539a5316c4b8c133771214a617
#14 ...

#33 [auth internal] load metadata for docker.io/library/gradle:8.8-jdk21-alpine
#33 DONE 2.4s

#28 [documents internal] load metadata for docker.io/library/node:20-alpine
#28 DONE 2.6s

#35 [auth internal] load metadata for docker.io/library/eclipse-temurin:21-jre-jammy
#35 DONE 2.5s

#29 [gateway internal] load metadata for docker.io/library/node:18-alpine
#29 DONE 2.0s

#14 [crm base 1/3] FROM docker.io/library/python:3.11-slim@sha256:8eb5fc663972b871c528fef04be4eaa9ab8ab4539a5316c4b8c133771214a617
#14 resolve docker.io/library/python:3.11-slim@sha256:8eb5fc663972b871c528fef04be4eaa9ab8ab4539a5316c4b8c133771214a617 0.7s done
#14 DONE 0.9s

#34 [crm internal] load build context
#34 ...

#36 [documents base 1/3] FROM docker.io/library/node:20-alpine@sha256:6178e78b972f79c335df281f4b7674a2d85071aae2af020ffa39f0a770265435
#36 DONE 0.0s

#37 [gateway base 1/3] FROM docker.io/library/node:18-alpine@sha256:8d6421d663b4c28fd3ebc498332f249011d118945588d0a35cb9bc4b8ca09d9e
#37 DONE 0.0s

#38 [auth build 1/4] FROM docker.io/library/gradle:8.8-jdk21-alpine@sha256:77c9c2b3386870f175c0350b19607d488f7578d0c5efdc20d37b0f5fd1376691
#38 DONE 0.0s

#39 [auth runtime 1/4] FROM docker.io/library/eclipse-temurin:21-jre-jammy@sha256:db1689535962d757a5adabf57387584ed543d38c0b9d1fe870123ea362ad73b0
#39 DONE 0.0s

#40 [auth runtime 2/4] WORKDIR /app
#40 CACHED

#34 [crm internal] load build context
#34 ...

#41 [auth runtime 3/4] RUN apt-get update     && apt-get install -y --no-install-recommends curl     && rm -rf /var/lib/apt/lists/*
#41 CACHED

#34 [crm internal] load build context
#34 transferring context: 296.17kB 3.0s
#34 ...

#42 [auth internal] load build context
#42 transferring context: 25.54kB 4.5s done
#42 DONE 5.3s

#43 [gateway internal] load build context
#43 ...

#44 [auth build 2/4] WORKDIR /workspace
#44 CACHED

#45 [auth build 3/4] COPY backend/auth/ .
#45 CACHED

#43 [gateway internal] load build context
#43 ...

#34 [crm internal] load build context
#34 transferring context: 1.20MB 9.1s done
#34 DONE 9.6s

#43 [gateway internal] load build context
#43 ...

#46 [crm base 2/3] RUN apt-get update     && apt-get install -y --no-install-recommends build-essential curl     && curl -sSL https://install.python-poetry.org | python3 -     && apt-get purge -y curl     && apt-get autoremove -y     && rm -rf /var/lib/apt/lists/*
#46 CACHED

#47 [crm base 3/3] WORKDIR /app
#47 CACHED

#48 [crm deps 1/3] COPY backend/crm/pyproject.toml ./pyproject.toml
#48 CACHED

#49 [crm deps 2/3] COPY backend/crm/poetry.lock ./poetry.lock
#49 CACHED

#50 [crm deps 3/3] RUN poetry config virtualenvs.create false     && poetry install --no-ansi --without dev --no-root
#50 CACHED

#51 [crm build 3/5] COPY --from=deps /app /app
#51 CACHED

#43 [gateway internal] load build context
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 ...

#53 [crm build 4/5] COPY backend/crm/ ./
#53 DONE 2.9s

#43 [gateway internal] load build context
#43 transferring context: 655.17kB 13.5s
#43 ...

#54 [auth build 4/4] RUN ./gradlew bootJar --no-daemon
#54 ...

#43 [gateway internal] load build context
#43 transferring context: 1.14MB 18.6s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 ...

#55 [crm build 5/5] RUN poetry config virtualenvs.create false     && poetry install --no-ansi --without dev
#55 ...

#43 [gateway internal] load build context
#43 transferring context: 1.52MB 23.9s
#43 transferring context: 1.89MB 28.9s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 transferring context: 2.38MB 34.2s
#43 transferring context: 2.55MB 39.4s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 transferring context: 2.64MB 44.5s
#43 transferring context: 2.75MB 49.5s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 transferring context: 2.88MB 54.5s
#43 transferring context: 3.07MB 59.7s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 transferring context: 3.43MB 64.8s
#43 transferring context: 3.53MB 70.5s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 ...

#54 [auth build 4/4] RUN ./gradlew bootJar --no-daemon
#54 56.85 Downloading https://services.gradle.org/distributions/gradle-8.14.3-bin.zip
#54 ...

#43 [gateway internal] load build context
#43 transferring context: 3.64MB 75.6s
#43 transferring context: 3.85MB 80.7s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 transferring context: 4.05MB 85.9s
#43 transferring context: 4.29MB 91.0s
#43 ...

#52 [documents internal] load build context
#52 ...

#43 [gateway internal] load build context
#43 transferring context: 4.49MB 96.2s
#43 transferring context: 4.77MB 101.3s
#43 ...

#52 [documents internal] load build context
#52 transferring context: 4.97MB 95.5s done
#52 ...

#43 [gateway internal] load build context
#43 transferring context: 4.80MB 102.1s
#43 transferring context: 4.80MB 103.8s done
#43 DONE 107.2s

#54 [auth build 4/4] RUN ./gradlew bootJar --no-daemon
#54 ...

#52 [documents internal] load build context
#52 DONE 107.3s

#56 [documents base 3/3] RUN corepack enable
#56 CACHED

#57 [documents base 2/3] WORKDIR /app
#57 CACHED

#58 [documents build 1/5] COPY backend/documents/pnpm-lock.yaml ./pnpm-lock.yaml
#58 CACHED

#59 [documents build 2/5] COPY backend/documents/package.json ./package.json
#59 CACHED

#60 [documents deps 3/3] RUN pnpm install --frozen-lockfile
#60 CACHED

#61 [documents build 3/5] COPY --from=deps /app/node_modules ./node_modules
#61 CACHED

#62 [documents production-deps 4/4] RUN pnpm prune --prod
#62 ...

#63 [gateway runtime 1/6] WORKDIR /app
#63 CACHED

#64 [gateway runtime 2/6] RUN corepack enable
#64 CACHED

#65 [gateway runtime 3/6] COPY backend/gateway/pnpm-lock.yaml ./pnpm-lock.yaml
#65 CACHED

#66 [gateway runtime 4/6] COPY backend/gateway/package.json ./package.json
#66 CACHED

#67 [gateway base 3/3] RUN corepack enable
#67 CACHED

#68 [gateway base 2/3] WORKDIR /app
#68 CACHED

#69 [gateway runtime 5/6] RUN pnpm install --frozen-lockfile --prod
#69 CACHED

#70 [gateway build 1/5] COPY backend/gateway/pnpm-lock.yaml ./pnpm-lock.yaml
#70 CACHED

#71 [gateway build 2/5] COPY backend/gateway/package.json ./package.json
#71 CACHED

#72 [gateway build 3/5] RUN pnpm install --frozen-lockfile
#72 CACHED

#73 [gateway build 4/5] COPY backend/gateway ./
#73 CACHED

#74 [gateway build 5/5] RUN pnpm build
#74 ...

#75 [documents build 4/5] COPY backend/documents/ ./
#75 ...

#54 [auth build 4/4] RUN ./gradlew bootJar --no-daemon
#54 121.5 
#54 121.6 Exception in thread "main" javax.net.ssl.SSLHandshakeException: Remote host terminated the handshake
#54 121.7 	at java.base/sun.security.ssl.SSLSocketImpl.handleEOF(SSLSocketImpl.java:1714)
#54 121.7 	at java.base/sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1514)
#54 121.7 	at java.base/sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1421)
#54 121.7 	at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:455)
#54 121.7 	at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:426)
#54 121.7 	at java.base/sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:586)
#54 121.7 	at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:187)
#54 121.7 	at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1675)
#54 121.7 	at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1599)
#54 121.8 	at java.base/sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:223)
#54 121.8 	at org.gradle.wrapper.Install.forceFetch(SourceFile:2)
#54 121.8 	at org.gradle.wrapper.Install$1.call(SourceFile:8)
#54 121.8 	at org.gradle.wrapper.GradleWrapperMain.main(SourceFile:67)
#54 121.8 Caused by: java.io.EOFException: SSL peer shut down incorrectly
#54 121.9 	at java.base/sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:494)
#54 121.9 	at java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(SSLSocketInputRecord.java:483)
#54 121.9 	at java.base/sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:160)
#54 121.9 	at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:111)
#54 121.9 	at java.base/sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1506)
#54 121.9 	... 11 more
#54 ...

#55 [crm build 5/5] RUN poetry config virtualenvs.create false     && poetry install --no-ansi --without dev
#55 134.1 Skipping virtualenv creation, as specified in config file.
#55 ...

#54 [auth build 4/4] RUN ./gradlew bootJar --no-daemon
#54 ERROR: process "/bin/sh -c ./gradlew bootJar --no-daemon" did not complete successfully: exit code: 1

#74 [gateway build 5/5] RUN pnpm build
#74 ...

#75 [documents build 4/5] COPY backend/documents/ ./
#75 CANCELED

#74 [gateway build 5/5] RUN pnpm build
#74 ...

#55 [crm build 5/5] RUN poetry config virtualenvs.create false     && poetry install --no-ansi --without dev
#55 CANCELED

#74 [gateway build 5/5] RUN pnpm build
#74 ...

#62 [documents production-deps 4/4] RUN pnpm prune --prod
#62 44.47 runc run failed: container process is already dead
------
 > [auth build 4/4] RUN ./gradlew bootJar --no-daemon:
121.8 	at org.gradle.wrapper.Install.forceFetch(SourceFile:2)
121.8 	at org.gradle.wrapper.Install$1.call(SourceFile:8)
121.8 	at org.gradle.wrapper.GradleWrapperMain.main(SourceFile:67)
121.8 Caused by: java.io.EOFException: SSL peer shut down incorrectly
121.9 	at java.base/sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:494)
121.9 	at java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(SSLSocketInputRecord.java:483)
121.9 	at java.base/sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:160)
121.9 	at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:111)
121.9 	at java.base/sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1506)
121.9 	... 11 more
------
target auth: failed to solve: process "/bin/sh -c ./gradlew bootJar --no-daemon" did not complete successfully: exit code: 1



View build details: docker-desktop://dashboard/build/default/default/f4wbc2mp0opd07viy8mdot7sr

[bootstrap-local][ошибка] Шаг 'Запуск backend-профиля' завершился с кодом 1. См. лог: ./.local/logs/bootstrap/run-20251028-025618/steps/10__backend-_.log
[bootstrap-local] → Ожидание готовности backend-сервисов
Ручной опрос готовности backend-сервисов (60 попыток с паузой 3с)
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING missing:gateway,auth,crm,documents
PENDING no-data
PENDING no-data
