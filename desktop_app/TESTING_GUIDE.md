# CRM Desktop Application - Testing Guide

## Подготовка к тестированию

### 1. Требования
- Python 3.8+
- Backend API должен быть запущен на http://localhost:8082/api/v1
- Доступ к БД

### 2. Установка зависимостей
```bash
cd desktop_app
pip install -r requirements.txt
```

### 3. Запуск приложения
```bash
python main.py
```

## Test Cases по функционалу

### A. Clients Tab (main.py)

#### TC-1: Создание клиента
1. Открыть приложение
2. На вкладке "Clients" нажать кнопку "Add"
3. В диалоге заполнить:
   - Name: "Тестовый клиент"
   - Email: "test@example.com"
   - Phone: "+7-999-123-45-67"
   - Status: "active"
4. Нажать OK
5. Ожидаемый результат: Клиент появился в таблице

#### TC-2: Редактирование клиента
1. В таблице Clients выбрать любого клиента
2. Нажать кнопку "Edit"
3. Изменить Name на "Изменённое имя"
4. Нажать OK
5. Ожидаемый результат: Имя клиента обновлено в таблице

#### TC-3: Удаление клиента
1. В таблице Clients выбрать клиента
2. Нажать кнопку "Delete"
3. Подтвердить удаление в диалоге
4. Ожидаемый результат: Клиент удалён из таблицы

#### TC-4: Просмотр деталей клиента
1. В таблице Clients двойной клик на строку клиента
2. Ожидаемый результат: Открывается Detail Dialog со всей информацией
3. Содержит вкладки: General Info, Timestamps

#### TC-5: Поиск клиентов
1. На вкладке Clients ввести текст в поле поиска (напр. имя)
2. Ожидаемый результат: Таблица фильтруется по имени, email, phone

#### TC-6: Экспорт клиентов
1. На вкладке Clients нажать "Export CSV" или "Export Excel"
2. Выбрать место сохранения файла
3. Ожидаемый результат: Файл создан с данными

---

### B. Deals Tab (deals_tab.py)

#### TC-7: Создание сделки
1. Открыть вкладку "Deals"
2. Нажать кнопку "Add Deal"
3. В диалоге заполнить:
   - Title: "Новая сделка"
   - Client: выбрать из dropdown'а (обязательно)
   - Description: "Описание сделки"
   - Status: "draft"
   - Next Review Date: "2024-12-31" (обязательно)
4. Нажать OK
5. Ожидаемый результат: Сделка добавлена в таблицу

**Важно**: Если dropdown Client пуст, значит нет клиентов в БД. Сначала создайте клиентов!

#### TC-8: Редактирование сделки
1. На вкладке Deals выбрать сделку
2. Нажать "Edit"
3. Изменить Title на "Обновлённая сделка"
4. Нажать OK
5. Ожидаемый результат: Название обновлено

#### TC-9: Удаление сделки
1. На вкладке Deals выбрать сделку
2. Нажать "Delete"
3. Подтвердить удаление
4. Ожидаемый результат: Сделка удалена

#### TC-10: Просмотр деталей сделки
1. На вкладке Deals двойной клик на строку
2. Ожидаемый результат: Detail Dialog с информацией
3. Вкладки: General Info, Description, Timestamps

---

### C. Payments Tab (payments_tab.py)

#### TC-11: Выбор сделки для платежей
1. Открыть вкладку "Payments"
2. В dropdown "Select Deal" выбрать сделку
3. Нажать "Refresh Deals" если список пуст
4. Ожидаемый результат: Список платежей загружен (если есть)

#### TC-12: Создание платежа
1. На вкладке Payments выбрать сделку из dropdown'а
2. Нажать "Add Payment"
3. В диалоге заполнить:
   - Deal: выбрать из dropdown'а (обязательно)
   - Policy: выбрать из dropdown'а (обязательно)
   - Sequence: "1"
   - Planned Amount: "5000" (обязательно)
   - Currency: "RUB"
   - Status: "scheduled"
   - Planned Date: "2024-12-15"
4. Нажать OK
5. Ожидаемый результат: Платёж добавлен

**Важно**: Если Policy dropdown пуст, создайте политики на вкладке Policies!

#### TC-13: Редактирование платежа
1. Выбрать платёж в таблице
2. Нажать "Edit"
3. Изменить Planned Amount
4. Нажать OK
5. Ожидаемый результат: Сумма обновлена

#### TC-14: Удаление платежа
1. Выбрать платёж в таблице
2. Нажать "Delete"
3. Подтвердить удаление
4. Ожидаемый результат: Платёж удалён

---

### D. Policies Tab (policies_tab.py)

#### TC-15: Создание политики
1. Открыть вкладку "Policies"
2. Нажать "Add Policy"
3. В диалоге заполнить:
   - Policy Number: "POL-2024-001" (обязательно)
   - Client: выбрать из dropdown'а (обязательно)
   - Deal: выбрать из dropdown'а (опционально)
   - Status: "draft"
   - Premium: "100000"
   - Effective From: "2024-01-01"
   - Effective To: "2024-12-31"
4. Нажать OK
5. Ожидаемый результат: Политика добавлена

#### TC-16: Редактирование политики
1. Выбрать политику в таблице
2. Нажать "Edit"
3. Изменить Premium на другое значение
4. Нажать OK
5. Ожидаемый результат: Premium обновлена

#### TC-17: Удаление политики
1. Выбрать политику в таблице
2. Нажать "Delete"
3. Подтвердить удаление
4. Ожидаемый результат: Политика удалена

---

### E. Calculations Tab (calculations_tab.py)

#### TC-18: Выбор сделки для расчётов
1. Открыть вкладку "Calculations"
2. В dropdown "Deal" выбрать сделку
3. Ожидаемый результат: Список расчётов загружен для выбранной сделки

#### TC-19: Создание расчёта
1. На вкладке Calculations выбрать сделку
2. Нажать "Add Calculation"
3. В диалоге заполнить:
   - Deal: выбрать из dropdown'а
   - Insurance Company: "ООО Страховщик" (обязательно)
   - Program Name: "Базовая программа"
   - Premium Amount: "50000"
   - Coverage Sum: "1000000"
   - Calculation Date: "2024-01-15"
   - Status: "draft"
   - Comments: "Комментарий"
4. Нажать OK
5. Ожидаемый результат: Расчёт добавлен

#### TC-20: Редактирование расчёта
1. Выбрать расчёт в таблице
2. Нажать "Edit"
3. Изменить Premium Amount
4. Нажать OK
5. Ожидаемый результат: Расчёт обновлён

---

### F. Tasks Tab (tasks_tab.py)

#### TC-21: Создание задачи
1. Открыть вкладку "Tasks"
2. Нажать "Add Task"
3. В диалоге заполнить:
   - Title: "Новая задача" (обязательно)
   - Description: "Описание"
   - Status: "open"
   - Priority: "normal"
   - Due Date: "2024-12-31"
4. Нажать OK
5. Ожидаемый результат: Задача добавлена

#### TC-22: Редактирование задачи
1. Выбрать задачу в таблице
2. Нажать "Edit"
3. Изменить Status на "in_progress"
4. Нажать OK
5. Ожидаемый результат: Статус обновлён

#### TC-23: Удаление задачи
1. Выбрать задачу в таблице
2. Нажать "Delete"
3. Подтвердить удаление
4. Ожидаемый результат: Задача удалена

---

## Тестирование Edge Cases

### TC-24: Валидация обязательных полей
1. На любой вкладке с Add/Edit нажать на "Add" или "Edit"
2. Оставить обязательное поле пустым
3. Нажать OK
4. Ожидаемый результат: Появляется ошибка "Field cannot be empty"

### TC-25: Некорректный выбор из dropdown'а
1. На вкладке Deals нажать "Edit"
2. Попробовать удалить выбранного клиента из dropdown'а
3. Нажать OK
4. Ожидаемый результат: Ошибка "Invalid client selected"

### TC-26: Невалидное числовое значение
1. На вкладке Deals заполнить Amount буквами "abc"
2. Нажать OK
3. Ожидаемый результат: Ошибка при преобразовании в float (или игнорирование)

### TC-27: Неправильный формат даты
1. На вкладке Deals заполнить Next Review Date "31-12-2024" (неправильный формат)
2. Нажать OK
3. Ожидаемый результат: Либо ошибка, либо принимается как текст

---

## Тестирование UI/UX

### TC-28: Responsiveness UI
1. Создать объект (Add)
2. Во время загрузки попробовать нажать на другие элементы UI
3. Ожидаемый результат: UI не зависает, операция выполняется в фоне

### TC-29: Error Messages
1. Вызвать ошибку на API (напр. выключить backend)
2. Попробовать любую операцию Add/Edit/Delete
3. Ожидаемый результат: Появляется информативная ошибка

### TC-30: Data Refresh
1. Создать объект через Add
2. Нажать Refresh
3. Ожидаемый результат: Таблица обновляется, объект присутствует

---

## Проверка Интеграции

### TC-31: Cascading Dropdowns
1. На вкладке Policies создать новую политику
2. Выбрать Client и затем Deal
3. Ожидаемый результат: Deal загружен правильно для выбранного Client

### TC-32: Data Consistency
1. Создать Deal с Client
2. Перейти на вкладку Payments
3. Выбрать созданный Deal
4. Попробовать создать Payment с этим Deal
5. Ожидаемый результат: Deal доступен в dropdown'е Payments

---

## Performance Tests

### TC-33: Large Data Sets
1. Иметь в БД 1000+ записей в какой-то таблице
2. Открыть эту вкладку
3. Ожидаемый результат: Загрузка занимает разумное время (< 5 сек)

### TC-34: Search Performance
1. На вкладке с 1000+ записей ввести поисковый запрос
2. Ожидаемый результат: Фильтрация происходит быстро

---

## Результаты тестирования

### Что работает
- [ ] Создание записей (Add)
- [ ] Редактирование записей (Edit)
- [ ] Удаление записей (Delete)
- [ ] Просмотр деталей (Detail View)
- [ ] Поиск и фильтрация
- [ ] Экспорт данных
- [ ] Validation

### Что не работает / Needs Debugging
- [ ] (Список проблем из тестирования)

### Known Issues
- Платежи могут вернуть 404 если endpoint не реализован
- Если нет клиентов, создание Deal не возможно
- Excel экспорт требует openpyxl

---

## Debugging Tips

### Логирование
Логи находятся в консоли приложения. Используйте для диагностики проблем.

### Проверка API
```bash
# Проверить, запущен ли backend
curl http://localhost:8082/api/v1/clients

# Проверить создание клиента
curl -X POST http://localhost:8082/api/v1/clients \
  -H "Content-Type: application/json" \
  -d '{"name":"Test","email":"test@test.com","phone":"+7"}'
```

### Network Debugging
Используйте Developer Tools браузера (если используется web-версия) или Wireshark для отслеживания сетевых запросов.

---

## Conclusion

После прохождения всех тестов приложение считается готовым к использованию. Документируйте найденные баги и создавайте issues для их решения.
