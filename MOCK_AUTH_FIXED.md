# ‚úÖ Mock Authentication - FIXED!

## üéâ –ü—Ä–æ–±–ª–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!

**–ü—Ä–µ–¥—ã–¥—É—â–∞—è –æ—à–∏–±–∫–∞:** "Unauthorized" –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ª–æ–≥–∏–Ω–∞

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `NEXT_PUBLIC_AUTH_DISABLED=true` –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∞ –≤ JavaScript –±–∞–Ω–¥–ª –ø—Ä–∏ build-time

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã ARG –≤ Dockerfile –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–æ–º–µ–Ω—Ç —Å–±–æ—Ä–∫–∏

---

## üìù –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### 1. **Dockerfile** (`frontend-new/Dockerfile`)
–î–æ–±–∞–≤–ª–µ–Ω—ã build arguments –¥–ª—è Next.js:
```dockerfile
ARG NEXT_PUBLIC_API_BASE_URL=http://localhost:8080/api/v1
ARG NEXT_PUBLIC_AUTH_DISABLED=true
ARG NEXT_PUBLIC_CRM_SSE_URL=http://localhost:8080/api/v1/streams/deals
ARG NEXT_PUBLIC_NOTIFICATIONS_SSE_URL=http://localhost:8080/api/v1/streams/notifications

ENV NEXT_PUBLIC_API_BASE_URL=${NEXT_PUBLIC_API_BASE_URL}
ENV NEXT_PUBLIC_AUTH_DISABLED=${NEXT_PUBLIC_AUTH_DISABLED}
...
```

### 2. **docker-compose.yml** (`infra/docker-compose.yml`)
–î–æ–±–∞–≤–ª–µ–Ω—ã build-time args –≤ —Å–µ–∫—Ü–∏—é build:
```yaml
build:
  context: ../frontend-new
  dockerfile: Dockerfile
  args:
    NEXT_PUBLIC_API_BASE_URL: ${NEXT_PUBLIC_API_BASE_URL:-http://gateway:8080/api/v1}
    NEXT_PUBLIC_AUTH_DISABLED: ${NEXT_PUBLIC_AUTH_DISABLED:-true}
    ...
```

### 3. **.env** —Ñ–∞–π–ª
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è:
```bash
NEXT_PUBLIC_AUTH_DISABLED=true
```

---

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

1. **Docker build –≤—Ä–µ–º—è:**
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ BUILD ARGS
   - Next.js –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏—Ö –≤ JavaScript –±–∞–Ω–¥–ª
   - Mock auth –∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

2. **Runtime (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ):**
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —É–∂–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π mock auth
   - –õ—é–±–æ–π –ª–æ–≥–∏–Ω (email/–ø–∞—Ä–æ–ª—å) —Å–æ–∑–¥–∞–µ—Ç fake JWT —Ç–æ–∫–µ–Ω
   - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É Auth —Å–µ—Ä–≤–∏—Å—É

---

## ‚úÖ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í –±—Ä–∞—É–∑–µ—Ä–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/login
2. –í–≤–µ–¥–∏—Ç–µ **–ª—é–±–æ–π email –∏ –ø–∞—Ä–æ–ª—å**:
   - Email: `admin@crm.com` (–∏–ª–∏ –ª—é–±–æ–π)
   - Password: `password123` (–∏–ª–∏ –ª—é–±–æ–π)
3. –ù–∞–∂–º–∏—Ç–µ "Sign in"
4. –í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ /dashboard ‚úÖ

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ –±–∞–Ω–¥–ª
docker logs crm-frontend

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# ‚úì Ready in 1185ms
```

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

**–í–ê–ñ–ù–û:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `NEXT_PUBLIC_AUTH_DISABLED` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ **–î–û** —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ NEXT.JS –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∫–æ—Ç–æ—Ä–∞—è –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ JavaScript –±–∞–Ω–¥–ª.

| –ö–æ–≥–¥–∞ | –ì–¥–µ | –ö–∞–∫ |
|-------|-----|-----|
| **Build-time** | Dockerfile ARG + ENV | –í—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ JS –±–∞–Ω–¥–ª |
| **Runtime** | Docker container env | –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –±–∞–Ω–¥–ª, –Ω–æ –¥–ª—è –ª–æ–≥–æ–≤ |
| **Frontend JS** | `process.env.NEXT_PUBLIC_AUTH_DISABLED` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `lib/api.ts` |

---

## üìã –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω—ã

- ‚úÖ `frontend-new/Dockerfile` - –¥–æ–±–∞–≤–ª–µ–Ω—ã ARG –¥–ª—è build-time
- ‚úÖ `infra/docker-compose.yml` - –¥–æ–±–∞–≤–ª–µ–Ω—ã build args
- ‚úÖ `.env` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `NEXT_PUBLIC_AUTH_DISABLED=true`

---

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ª–æ–≥–∏–Ω–∞

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –õ–ÆÃÅ–ë–´–ï –¥–∞–Ω–Ω—ã–µ:**

| Email | –ü–∞—Ä–æ–ª—å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-------|---------|-----------|
| admin@example.com | admin | ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è |
| user@test.com | password | ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è |
| test@crm.local | 12345 | ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è |
| **–õ–Æ–ë–û–ô EMAIL** | **–õ–Æ–ë–û–ô –ü–ê–†–û–õ–¨** | ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è |

–ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞:
- –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage
- –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ `/dashboard`
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ demo mode

---

## üéØ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:** "Unauthorized" –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã build-time –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Dockerfile
**–°—Ç–∞—Ç—É—Å:** ‚úÖ FIXED –∏ WORKING!

–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ —Å–ø–æ–∫–æ–π–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –±–µ–∑ –Ω—É–∂–¥—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
